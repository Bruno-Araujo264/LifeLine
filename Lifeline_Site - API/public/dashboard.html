<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="icon" href="imgs/caderno.png">
    <script src="js/dashboard.js"></script>
    <title>LifeLine</title>
</head>
<body>
<audio id="paginaVirando" src="audio/page-flip1-178322.mp3"></audio>

    <!-- Botão voltar -->
     <button id="voltar" onclick="paginaVirando.play()">
        <i class="seta-esquerda">&larr;</i>
     </button>


    <!-- Livro -->
     <div id="livro" class="livro">
        <!-- pagina1/2 -->
         <div id="p1" class="papel">
            <div class="frente">
                <div id="f1" class="conteudo-frente">
                    <header>Lifeline</header>
                    <h1>Estatísticas</h1>
                    <footer>
                        Feito por Bruno Araújo
                    </footer>
                </div>
            </div>
            <div class="verso">
                <div id="v1" class="conteudo-verso">
                    <h1>Bem vindo,<p id="nomeUsuario"></p></h1>
                    <span>
                        
                    </span>
                </div>
            </div>
         </div>
         <!-- pagina3/4 -->
         <div id="p2" class="papel">
            <div class="frente">
                <div id="f2" class="conteudo-frente">
                    <div id="assunto">
                        <b>Assunto:</b>
                        <input type="text" id="inp_assunto" placeholder="Sobre o que você quer falar">
                    </div>
                    <div id="data">
                        <b>Data:</b>
                        <input type="date" id="inp_data" placeholder="DD/MM/AAAA">
                    </div>
                        
                        <center>
                            <span>Como você está se sentindo</span><br>
                        </center>
                        <div id="sentimentos">
                            <div class="emocao">
                                <img src="imgs/feliz.png" id="feliz" class="emoji" draggable="false" onclick="chooseFeeling('feliz')">
                                <p>Feliz</p> 
                            </div>
                            <div class="emocao">
                                <img src="imgs/triste.png" id="triste" class="emoji" draggable="false" onclick="chooseFeeling('triste')">
                                <p>Triste</p> 
                            </div>
                            <div class="emocao">
                                <img src="imgs/bravo.png" id="raiva" class="emoji" draggable="false" onclick="chooseFeeling('raiva')">
                                <p>Raiva</p> 
                            </div>
                            <div class="emocao surpreso">
                                <img src="imgs/surpreso.png" id="surpreso" class="emoji" draggable="false" onclick="chooseFeeling('surpreso')">
                                <p>Surpreso</p> 
                            </div>
                            <div class="emocao">
                                <img src="imgs/medo.png" id="medo" class="emoji" draggable="false" onclick="chooseFeeling('medo')"> 
                                <p>Medo</p> 
                            </div>
                        </div>
                        <div id="acontecimento" onclick="inp_acontecimento.focus()">
                            <textarea id="inp_acontecimento" placeholder="Escreva o que aconteceu..."></textarea>
                            <!-- <div class="imagem">
                                <img src="imgs/foto.png">
                            </div> -->
                        </div>
                        <button id="btn-enviar" onclick="registrar()">Adicionar registro</button>
                </div>
            </div>
            <div class="verso">
                <div id="v2" class="conteudo-verso">
                    
                </div>
            </div>
     </div>
    </div>
     <!-- Botão avançar -->
    <button id="avançar" onclick="paginaVirando.play()">
        <i class="seta-direita">&rarr;</i>
     </button>

    
</body>
</html>

<script>
    function cadastrar() {

//Recupere o valor da nova input pelo nome do id
// Agora vá para o método fetch logo abaixo
var nomeVar = inp_nome.value;
var senhaVar = inp_senhaCadastro.value;
var emailVar = inp_emailCadastro.value;
var tituloVar = inp_titulo.value;

// Verificando se há algum campo em branco
if (
  nomeVar == "" ||
  senhaVar == "" ||
  emailVar == "" ||
  tituloVar == ""
) {
  alert("Campos em branco")
}

// Enviando o valor da nova input
fetch("/usuarios/cadastrar", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    // crie um atributo que recebe o valor recuperado aqui
    // Agora vá para o arquivo routes/usuario.js
    nomeServer: nomeVar,
    senhaServer: senhaVar,
    emailServer: emailVar,
    tituloServer: tituloVar
  }),
})
  .then(function (resposta) {
    console.log("resposta: ", resposta);

    if (resposta.ok) {

      setTimeout(() => {
        window.location = "escrever.html";
      }, "2000");

      limparFormulario();
    } else {
      throw "Houve um erro ao tentar realizar o cadastro!";
    }
  })
  .catch(function (resposta) {
    console.log(`#ERRO: ${resposta}`);
  });

return false;
}

function entrar() {

        var emailVar = inp_emailLogin.value;
        var senhaVar = inp_senhaLogin.value;

        if (emailVar == "" || senhaVar == "") {
            return false;
        }

        console.log("FORM LOGIN: ", emailVar);
        console.log("FORM SENHA: ", senhaVar);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: emailVar,
                senhaServer: senhaVar
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                        window.location = "escrever.html";
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }


</script>